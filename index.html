<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>‡§ï‡§ø‡§∏‡§æ‡§® ‡§Æ‡§ø‡§§‡•ç‡§∞ - Crop Predictor | ‡§ï‡•É‡§∑‡§ø ‡§∏‡§≤‡§æ‡§π‡§ï‡§æ‡§∞</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
            min-height:100vh; padding:20px;
        }
        .container { max-width:1200px; margin:0 auto; }
        .header { text-align:center; margin-bottom:30px; color:white; position:relative; }
        .header h1 { font-size:2.5rem; margin-bottom:10px; text-shadow:2px 2px 4px rgba(0,0,0,0.3); }
        .header p { font-size:1.1rem; opacity:0.95; }
        .language-toggle {
            position:absolute; top:0; right:0;
            background: rgba(255,255,255,0.18); border:2px solid rgba(255,255,255,0.28);
            border-radius:25px; padding:10px 18px; color:white; cursor:pointer;
            transition:all .25s; backdrop-filter: blur(10px); font-weight:600; display:flex; gap:8px; align-items:center;
        }
        .main-card {
            background:white; border-radius:20px; box-shadow:0 20px 40px rgba(0,0,0,0.1);
            overflow:hidden; display:grid; grid-template-columns:1fr 1fr; min-height:600px;
        }
        .input-section { padding:36px; background:linear-gradient(145deg,#f8f9ff,#e8ecff); border-right:1px solid #e0e0e0; }
        .output-section { padding:36px; background:linear-gradient(145deg,#fff8f0,#f0f8ff); display:flex; flex-direction:column; justify-content:center; align-items:center; }
        .form-group { margin-bottom:22px; }
        .form-group label { display:block; font-weight:600; margin-bottom:8px; color:#333; font-size:1.05rem; }
        .bilingual { color:#666; font-size:0.9rem; font-weight:400; }
        .form-control { width:100%; padding:12px 14px; border:2px solid #e0e0e0; border-radius:10px; font-size:1rem; background:white; transition:all .18s; }
        .form-control:focus { border-color:#667eea; box-shadow:0 0 0 3px rgba(102,126,234,0.08); outline:none; transform:scale(1.01); }
        .form-row { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
        .predict-btn { width:100%; padding:14px; background:linear-gradient(45deg,#ff6b6b,#ee5a24); color:white; border:none; border-radius:10px; font-size:1.12rem; font-weight:700; cursor:pointer; text-transform:uppercase; letter-spacing:1px; }
        .predict-btn:disabled { opacity:0.6; cursor:not-allowed; }
        .result-card { background:white; border-radius:12px; padding:20px; margin-bottom:16px; box-shadow:0 8px 18px rgba(0,0,0,0.08); border-left:5px solid #4CAF50; width:100%; max-width:520px; }
        .result-title { font-size:1.18rem; font-weight:700; color:#333; margin-bottom:8px; display:flex; align-items:center; gap:8px; justify-content:center; }
        .result-value { font-size:1.35rem; font-weight:800; color:#2e7d32; margin-bottom:6px; text-align:center; }
        .result-subtitle { color:#666; font-size:0.92rem; text-align:center; }
        .empty-state { opacity:0.85; text-align:center; }
        .empty-state i { font-size:3.8rem; color:#ddd; margin-bottom:12px; display:block; }
        .loading { display:none; text-align:center; padding:28px; }
        .spinner { width:48px; height:48px; border:5px solid #f3f3f3; border-top:5px solid #667eea; border-radius:50%; animation:spin 1s linear infinite; margin:0 auto 12px; }
        @keyframes spin { 0%{transform:rotate(0);} 100%{transform:rotate(360deg);} }
        @media (max-width:768px) {
            .main-card { grid-template-columns:1fr; }
            .form-row { grid-template-columns:1fr; gap:12px; }
            .language-toggle { position:static; margin-bottom:14px; display:inline-flex; }
        }
        .info-tooltip { position:relative; display:inline-block; margin-left:6px; color:#667eea; cursor:help; }
        .tooltip-text { visibility:hidden; width:210px; background:#333; color:#fff; text-align:center; border-radius:6px; padding:8px; position:absolute; z-index:1; bottom:125%; left:50%; margin-left:-105px; font-size:0.85rem; opacity:0; transition:opacity .2s; }
        .info-tooltip:hover .tooltip-text { visibility:visible; opacity:1; }
        .notification { position:fixed; top:20px; right:20px; z-index:1200; padding:12px 16px; color:white; border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,0.18); }
        /* debug panel */
        #debugPanel {
            position:fixed; left:20px; bottom:20px; background:rgba(0,0,0,0.75); color:white; padding:12px; border-radius:8px;
            max-width:380px; max-height:40vh; overflow:auto; font-size:12px; display:none; z-index:2000;
        }
        #debugPanel pre { white-space:pre-wrap; word-break:break-word; color:#fff; margin:0; font-size:12px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="language-toggle" id="languageToggle" role="button" aria-pressed="false" tabindex="0">
                <i class="fas fa-language" aria-hidden="true"></i>
                <span id="langText">‡§π‡§ø‡§Ç‡§¶‡•Ä</span>
            </div>
            <h1><i class="fas fa-seedling"></i> <span id="mainTitle">‡§ï‡§ø‡§∏‡§æ‡§® ‡§Æ‡§ø‡§§‡•ç‡§∞ - Crop Predictor</span></h1>
            <p id="subtitle">‡§Ü‡§™‡§ï‡•Ä ‡§´‡§∏‡§≤ ‡§ï‡•Ä ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø‡§µ‡§æ‡§£‡•Ä ‡§ï‡§∞‡§®‡•á ‡§µ‡§æ‡§≤‡§æ ‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§∏‡§≤‡§æ‡§π‡§ï‡§æ‡§∞</p>
        </div>

        <div class="main-card">
            <div class="input-section">
                <h2 style="text-align:center; color:#333; margin-bottom:18px;"><i class="fas fa-edit"></i> <span id="formTitle">‡§´‡§∏‡§≤ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§¶‡•á‡§Ç</span></h2>

                <form id="cropForm">
                    <div class="form-group">
                        <label for="soil" id="soilLabel">‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§ï‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞
                            <i class="fas fa-info-circle info-tooltip">
                                <span class="tooltip-text" id="soilTooltip">‡§Ö‡§™‡§®‡•á ‡§ñ‡•á‡§§ ‡§ï‡•Ä ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§ï‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç</span>
                            </i>
                        </label>
                        <select id="soil" class="form-control" required aria-required="true">
                            <option value="" id="soilPlaceholder" disabled selected>‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç</option>
                            <!-- fallback hardcoded options kept visually; backend is source of truth when available -->
                            <option value="alluvial">‡§ú‡§≤‡•ã‡§¢‡§º ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä | Alluvial Soil</option>
                            <option value="loamy">‡§¶‡•ã‡§Æ‡§ü ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä | Loamy Soil</option>
                            <option value="clay">‡§ö‡§ø‡§ï‡§®‡•Ä ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä | Clay Soil</option>
                            <option value="well-drained">‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§ú‡§≤ ‡§®‡§ø‡§ï‡§æ‡§∏‡•Ä ‡§µ‡§æ‡§≤‡•Ä ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä | Well-drained Soil</option>
                            <option value="red">‡§≤‡§æ‡§≤ ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä | Red Soil</option>
                            <option value="black">‡§ï‡§æ‡§≤‡•Ä ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä | Black Soil</option>
                            <option value="sandy">‡§∞‡•á‡§§‡•Ä‡§≤‡•Ä ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä | Sandy Soil</option>
                            <option value="sandy-loamy">‡§∞‡•á‡§§‡•Ä‡§≤‡•Ä ‡§¶‡•ã‡§Æ‡§ü ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä | Sandy Loamy Soil</option>
                            <option value="clay-loamy">‡§ö‡§ø‡§ï‡§®‡•Ä ‡§¶‡•ã‡§Æ‡§ü ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä | Clay Loamy Soil</option>
                            <option value="laterite">‡§≤‡•á‡§ü‡§∞‡§æ‡§á‡§ü ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä | Laterite Soil</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <!-- SOWN is month selector (1-12) -->
                        <label for="sown" id="seasonLabel">‡§¨‡•Å‡§µ‡§æ‡§à ‡§Æ‡§æ‡§π (1‚Äì12)
                            <i class="fas fa-info-circle info-tooltip">
                                <span class="tooltip-text" id="seasonTooltip">‡§Ü‡§™ ‡§ï‡§ø‡§∏ ‡§Æ‡§π‡•Ä‡§®‡•á ‡§¨‡•Å‡§µ‡§æ‡§à ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç? (1 = ‡§ú‡§®‡§µ‡§∞‡•Ä, 12 = ‡§¶‡§ø‡§∏‡§Ç‡§¨‡§∞)</span>
                            </i>
                        </label>
                        <select id="sown" class="form-control" required aria-required="true">
                            <option value="" id="seasonPlaceholder" disabled selected>‡§Æ‡§æ‡§π ‡§ö‡•Å‡§®‡•á‡§Ç / Select month</option>
                            <option value="1">‡§ú‡§®‡§µ‡§∞‡•Ä | January (1)</option>
                            <option value="2">‡§´‡§º‡§∞‡§µ‡§∞‡•Ä | February (2)</option>
                            <option value="3">‡§Æ‡§æ‡§∞‡•ç‡§ö | March (3)</option>
                            <option value="4">‡§Ö‡§™‡•ç‡§∞‡•à‡§≤ | April (4)</option>
                            <option value="5">‡§Æ‡§à | May (5)</option>
                            <option value="6">‡§ú‡•Ç‡§® | June (6)</option>
                            <option value="7">‡§ú‡•Å‡§≤‡§æ‡§à | July (7)</option>
                            <option value="8">‡§Ö‡§ó‡§∏‡•ç‡§§ | August (8)</option>
                            <option value="9">‡§∏‡§ø‡§§‡§Ç‡§¨‡§∞ | September (9)</option>
                            <option value="10">‡§Ö‡§ï‡•ç‡§ü‡•Ç‡§¨‡§∞ | October (10)</option>
                            <option value="11">‡§®‡§µ‡§Æ‡•ç‡§¨‡§∞ | November (11)</option>
                            <option value="12">‡§¶‡§ø‡§∏‡§Æ‡•ç‡§¨‡§∞ | December (12)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="soil_ph" id="phLabel">‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§ï‡§æ pH <span class="bilingual">(6.0 - 8.5)</span></label>
                        <input id="soil_ph" type="number" step="0.1" min="4" max="10" class="form-control" placeholder="e.g. 7.0" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="temp" id="tempLabel">‡§§‡§æ‡§™‡§Æ‡§æ‡§® <span class="bilingual">(¬∞C)</span></label>
                            <input id="temp" type="number" step="0.1" min="-10" max="50" class="form-control" placeholder="e.g. 25" required>
                        </div>
                        <div class="form-group">
                            <label for="humidity" id="humidityLabel">‡§Ü‡§∞‡•ç‡§¶‡•ç‡§∞‡§§‡§æ <span class="bilingual">(%)</span></label>
                            <input id="humidity" type="number" step="1" min="0" max="100" class="form-control" placeholder="e.g. 60" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="nitrogen" id="nitrogenLabel">‡§®‡§æ‡§á‡§ü‡•ç‡§∞‡•ã‡§ú‡§® (N) <span class="bilingual">(kg/ha)</span></label>
                            <input id="nitrogen" type="number" step="1" min="0" max="300" class="form-control" placeholder="e.g. 50" required>
                        </div>
                        <div class="form-group">
                            <label for="phosphorus" id="phosphorusLabel">‡§´‡§æ‡§∏‡•ç‡§´‡•ã‡§∞‡§∏ (P) <span class="bilingual">(kg/ha)</span></label>
                            <input id="phosphorus" type="number" step="1" min="0" max="150" class="form-control" placeholder="e.g. 25" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="potassium" id="potassiumLabel">‡§™‡•ã‡§ü‡•à‡§∂‡§ø‡§Ø‡§Æ (K) <span class="bilingual">(kg/ha)</span></label>
                        <input id="potassium" type="number" step="1" min="0" max="250" class="form-control" placeholder="e.g. 30" required>
                    </div>

                    <button id="predictBtnEl" type="submit" class="predict-btn"><i class="fas fa-magic"></i> <span id="predictBtn">‡§´‡§∏‡§≤ ‡§ï‡•Ä ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø‡§µ‡§æ‡§£‡•Ä ‡§ï‡§∞‡•á‡§Ç</span></button>
                </form>
            </div>

            <div class="output-section">
                <div id="resultsContainer" class="results-container">
                    <div class="empty-state" id="emptyState">
                        <i class="fas fa-seedling" aria-hidden="true"></i>
                        <p id="emptyStateText">‡§ï‡•É‡§™‡§Ø‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§≠‡§∞‡•á‡§Ç<br><span class="bilingual">Please fill the details to get crop predictions</span></p>
                    </div>
                </div>

                <div id="loadingState" class="loading" aria-hidden="true">
                    <div class="spinner" role="status" aria-label="loading"></div>
                    <p id="loadingText">‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø‡§µ‡§æ‡§£‡•Ä ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à...<br><span class="bilingual">Analyzing your data...</span></p>
                </div>
            </div>
        </div>
    </div>

    <!-- debug panel (hidden by default) -->
    <div id="debugPanel" aria-hidden="true"><pre id="debugPre"></pre></div>

    <script>
        // Language system
        let currentLang = 'hi';
        const translations = {
            hi: {
                langText: "English",
                mainTitle: "‡§ï‡§ø‡§∏‡§æ‡§® ‡§Æ‡§ø‡§§‡•ç‡§∞ - Crop Predictor",
                subtitle: "‡§Ü‡§™‡§ï‡•Ä ‡§´‡§∏‡§≤ ‡§ï‡•Ä ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø‡§µ‡§æ‡§£‡•Ä ‡§ï‡§∞‡§®‡•á ‡§µ‡§æ‡§≤‡§æ ‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§∏‡§≤‡§æ‡§π‡§ï‡§æ‡§∞",
                formTitle: "‡§´‡§∏‡§≤ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§¶‡•á‡§Ç",
                soilLabel: "‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§ï‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞",
                soilTooltip: "‡§Ö‡§™‡§®‡•á ‡§ñ‡•á‡§§ ‡§ï‡•Ä ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§ï‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç",
                soilPlaceholder: "‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç",
                seasonLabel: "‡§¨‡•Å‡§µ‡§æ‡§à ‡§Æ‡§æ‡§π (1‚Äì12)",
                seasonTooltip: "‡§Ü‡§™ ‡§ï‡§ø‡§∏ ‡§Æ‡§π‡•Ä‡§®‡•á ‡§¨‡•Å‡§µ‡§æ‡§à ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç? (1 = ‡§ú‡§®‡§µ‡§∞‡•Ä, 12 = ‡§¶‡§ø‡§∏‡§Ç‡§¨‡§∞)",
                seasonPlaceholder: "‡§Æ‡§æ‡§π ‡§ö‡•Å‡§®‡•á‡§Ç / Select month",
                phLabel: "‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§ï‡§æ pH",
                tempLabel: "‡§§‡§æ‡§™‡§Æ‡§æ‡§®",
                humidityLabel: "‡§Ü‡§∞‡•ç‡§¶‡•ç‡§∞‡§§‡§æ",
                nitrogenLabel: "‡§®‡§æ‡§á‡§ü‡•ç‡§∞‡•ã‡§ú‡§® (N)",
                phosphorusLabel: "‡§´‡§æ‡§∏‡•ç‡§´‡•ã‡§∞‡§∏ (P)",
                potassiumLabel: "‡§™‡•ã‡§ü‡•à‡§∂‡§ø‡§Ø‡§Æ (K)",
                predictBtn: "‡§´‡§∏‡§≤ ‡§ï‡•Ä ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø‡§µ‡§æ‡§£‡•Ä ‡§ï‡§∞‡•á‡§Ç",
                emptyStateText: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§≠‡§∞‡•á‡§Ç<br><span class=\"bilingual\">Please fill the details to get crop predictions</span>",
                loadingText: "‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø‡§µ‡§æ‡§£‡•Ä ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à...<br><span class=\"bilingual\">Analyzing your data...</span>",
                recommendedCrop: "‡§∏‡•Å‡§ù‡§æ‡§µ‡§ø‡§§ ‡§´‡§∏‡§≤",
                waterSource: "‡§™‡§æ‡§®‡•Ä ‡§ï‡§æ ‡§∏‡•ç‡§∞‡•ã‡§§",
                cropDuration: "‡§´‡§∏‡§≤ ‡§ï‡•Ä ‡§Ö‡§µ‡§ß‡§ø",
                waterRequired: "‡§™‡§æ‡§®‡•Ä ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ",
                bestSuited: "‡§Ü‡§™‡§ï‡•Ä ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§ï‡•á ‡§Ö‡§®‡•Å‡§ï‡•Ç‡§≤",
                optimalIrrigation: "‡§¨‡•á‡§π‡§§‡§∞ ‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à ‡§ï‡•á ‡§≤‡§ø‡§è",
                sowingToHarvest: "‡§¨‡•Å‡§µ‡§æ‡§à ‡§∏‡•á ‡§ï‡§ü‡§æ‡§à ‡§§‡§ï",
                perKgProduction: "‡§™‡•ç‡§∞‡§§‡§ø ‡§ï‡§ø‡§≤‡•ã ‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§®"
            },
            en: {
                langText: "‡§π‡§ø‡§Ç‡§¶‡•Ä",
                mainTitle: "Farmer Friend - Crop Predictor",
                subtitle: "Your Smart Agricultural Advisor for Crop Prediction",
                formTitle: "Enter Crop Details",
                soilLabel: "Soil Type",
                soilTooltip: "Select the type of soil in your field",
                soilPlaceholder: "Select Soil",
                seasonLabel: "Sowing Month (1‚Äì12)",
                seasonTooltip: "Which month are you sowing? (1 = Jan, 12 = Dec)",
                seasonPlaceholder: "Select month",
                phLabel: "Soil pH",
                tempLabel: "Temperature",
                humidityLabel: "Humidity",
                nitrogenLabel: "Nitrogen (N)",
                phosphorusLabel: "Phosphorus (P)",
                potassiumLabel: "Potassium (K)",
                predictBtn: "Predict Crop",
                emptyStateText: "Please fill the details to get crop predictions",
                loadingText: "Analyzing your data...",
                recommendedCrop: "Recommended Crop",
                waterSource: "Water Source",
                cropDuration: "Crop Duration",
                waterRequired: "Water Required",
                bestSuited: "Best suited for your soil",
                optimalIrrigation: "For optimal irrigation",
                sowingToHarvest: "From sowing to harvest",
                perKgProduction: "Per kg of production"
            }
        };

        function updateLanguage() {
            const lang = currentLang;
            document.getElementById('langText').textContent = translations[lang].langText;
            document.getElementById('mainTitle').textContent = translations[lang].mainTitle;
            document.getElementById('subtitle').textContent = translations[lang].subtitle;
            document.getElementById('formTitle').textContent = translations[lang].formTitle;

            document.getElementById('soilLabel').innerHTML = translations[lang].soilLabel + ` <i class="fas fa-info-circle info-tooltip"><span class="tooltip-text">${translations[lang].soilTooltip}</span></i>`;
            const soilPlaceholder = document.getElementById('soilPlaceholder'); if (soilPlaceholder) soilPlaceholder.textContent = translations[lang].soilPlaceholder;

            document.getElementById('seasonLabel').innerHTML = translations[lang].seasonLabel + ` <i class="fas fa-info-circle info-tooltip"><span class="tooltip-text">${translations[lang].seasonTooltip}</span></i>`;
            const seasonPlaceholder = document.getElementById('seasonPlaceholder'); if (seasonPlaceholder) seasonPlaceholder.textContent = translations[lang].seasonPlaceholder;

            document.getElementById('phLabel').innerHTML = translations[lang].phLabel + ' <span class="bilingual">(6.0 - 8.5)</span>';
            document.getElementById('tempLabel').innerHTML = translations[lang].tempLabel + ' <span class="bilingual">(¬∞C)</span>';
            document.getElementById('humidityLabel').innerHTML = translations[lang].humidityLabel + ' <span class="bilingual">(%)</span>';
            document.getElementById('nitrogenLabel').innerHTML = translations[lang].nitrogenLabel + ' <span class="bilingual">(kg/ha)</span>';
            document.getElementById('phosphorusLabel').innerHTML = translations[lang].phosphorusLabel + ' <span class="bilingual">(kg/ha)</span>';
            document.getElementById('potassiumLabel').innerHTML = translations[lang].potassiumLabel + ' <span class="bilingual">(kg/ha)</span>';

            document.getElementById('predictBtn').textContent = translations[lang].predictBtn;
            document.getElementById('emptyStateText').innerHTML = translations[lang].emptyStateText;
            document.getElementById('loadingText').innerHTML = translations[lang].loadingText;
        }

        document.getElementById('languageToggle').addEventListener('click', function() {
            currentLang = (currentLang === 'hi') ? 'en' : 'hi';
            this.setAttribute('aria-pressed', currentLang === 'en');
            updateLanguage();
        });

        // Backend config (update baseURL for local/dev)
        const API_CONFIG = {
            baseURL: 'https://crop-sage-uj67.onrender.com', // replace with http://localhost:8000 when testing locally
            endpoints: {
                soilTypes: '/api/soil-types',
                weatherData: '/api/weather',
                cropPrediction: '/api/predict-crop',
                health: '/health',
                debugEncoders: '/api/debug/encoders'
            }
        };

        class BackendAPI {
            static async makeRequest(endpoint, options = {}) {
                const url = `${API_CONFIG.baseURL}${endpoint}`;
                const defaultOptions = { headers: { 'Content-Type':'application/json', 'Accept':'application/json' } };
                try {
                    const resp = await fetch(url, { ...defaultOptions, ...options });
                    const text = await resp.text();
                    const data = text ? JSON.parse(text) : null;
                    if (!resp.ok) {
                        return { success:false, status:resp.status, data, error: data?.detail || resp.statusText || `HTTP ${resp.status}` };
                    }
                    return { success:true, status:resp.status, data };
                } catch (err) {
                    console.error('Network/API Error:', err);
                    return { success:false, error: err.message || 'Network error' };
                }
            }

            static async checkHealth() { return await this.makeRequest(API_CONFIG.endpoints.health); }
            static async getSoilTypes() { return await this.makeRequest(API_CONFIG.endpoints.soilTypes); }
            static async getWeatherData(lat, lon) {
                const endpoint = `${API_CONFIG.endpoints.weatherData}?lat=${lat}&lon=${lon}`;
                return await this.makeRequest(endpoint);
            }
            static async predictCrop(payload) {
                return await this.makeRequest(API_CONFIG.endpoints.cropPrediction, { method:'POST', body: JSON.stringify(payload) });
            }
            static async getDebugEncoders() {
                return await this.makeRequest(API_CONFIG.endpoints.debugEncoders);
            }
            static async getUserLocation() {
                return new Promise((resolve, reject) => {
                    if (!navigator.geolocation) return reject(new Error('Geolocation not supported'));
                    navigator.geolocation.getCurrentPosition(
                        pos => resolve({ latitude: pos.coords.latitude, longitude: pos.coords.longitude }),
                        err => reject(new Error(err.message)),
                        { enableHighAccuracy:true, timeout:10000, maximumAge:300000 }
                    );
                });
            }
        }

        // Small UI helpers
        function showNotification(message, type='info') {
            const el = document.createElement('div');
            el.className = 'notification';
            el.style.background = (type === 'success' ? '#4CAF50' : type === 'warning' ? '#FF9800' : '#2196F3');
            el.textContent = message;
            document.body.appendChild(el);
            setTimeout(()=> el.style.opacity = '1', 10);
            setTimeout(()=> { el.style.opacity = '0'; setTimeout(()=> el.remove(), 300); }, 3800);
        }

        function setLoading(isLoading) {
            const results = document.getElementById('resultsContainer');
            const loading = document.getElementById('loadingState');
            const submitBtn = document.getElementById('predictBtnEl');
            if (isLoading) {
                results.style.display = 'none';
                loading.style.display = 'block';
                loading.setAttribute('aria-hidden','false');
                submitBtn.disabled = true;
            } else {
                loading.style.display = 'none';
                loading.setAttribute('aria-hidden','true');
                submitBtn.disabled = false;
                results.style.display = 'block';
            }
        }

        function displayResults(prediction) {
            const lang = currentLang;
            // prediction expected shape:
            // { crop: 'Label', water_source: 'Label', crop_duration: number|string, water_required: number|string, confidence: number (0-1) optional }
            document.getElementById('resultsContainer').innerHTML = `
                <div class="result-card">
                    <div class="result-title"><i class="fas fa-seedling"></i> ${translations[lang].recommendedCrop}</div>
                    <div class="result-value">${prediction.crop}</div>
                    <div class="result-subtitle">${translations[lang].bestSuited}</div>
                </div>
                <div class="result-card">
                    <div class="result-title"><i class="fas fa-tint"></i> ${translations[lang].waterSource}</div>
                    <div class="result-value">${prediction.water_source}</div>
                    <div class="result-subtitle">${translations[lang].optimalIrrigation}</div>
                </div>
                <div class="result-card">
                    <div class="result-title"><i class="fas fa-calendar-alt"></i> ${translations[lang].cropDuration}</div>
                    <div class="result-value">${prediction.crop_duration}</div>
                    <div class="result-subtitle">${translations[lang].sowingToHarvest}</div>
                </div>
                <div class="result-card">
                    <div class="result-title"><i class="fas fa-water"></i> ${translations[lang].waterRequired}</div>
                    <div class="result-value">${prediction.water_required}</div>
                    <div class="result-subtitle">${translations[lang].perKgProduction}</div>
                </div>
                ${typeof prediction.confidence === 'number' ? `
                <div class="result-card" style="border-left-color:#1976d2;">
                    <div class="result-title"><i class="fas fa-chart-line"></i> Prediction Confidence</div>
                    <div class="result-value">${Math.round(prediction.confidence * 100)}%</div>
                    <div class="result-subtitle">Model reported confidence</div>
                </div>` : ''}
            `;
        }

        function showErrorMessage(message, backendDetail) {
            document.getElementById('resultsContainer').innerHTML = `
                <div class="result-card" style="border-left-color:#f44336;">
                    <div class="result-title" style="color:#f44336;"><i class="fas fa-exclamation-triangle"></i> Error</div>
                    <div class="result-value" style="color:#f44336; font-size:1.05rem;">${message}</div>
                    <div class="result-subtitle">Please check your backend and try again</div>
                </div>
            `;
            // If backend returns a hint, fetch and display debug encoders (dev-only debug panel)
            if (backendDetail) {
                openDebugPanelWithEncoders();
            }
        }

        // Populate soil select from backend tokens. Falls back to built-in options on failure.
        async function populateSoilFromServer() {
            try {
                const resp = await BackendAPI.getSoilTypes();
                if (!resp.success || !resp.data) {
                    console.warn('Could not load soil types:', resp.error || resp);
                    return;
                }
                // resp.data may be { soil_types: [...] } or an array
                const list = Array.isArray(resp.data) ? resp.data : (resp.data.soil_types || []);
                if (!list || !list.length) return;
                const soilSelect = document.getElementById('soil');
                const placeholder = soilSelect.querySelector('#soilPlaceholder');
                soilSelect.innerHTML = '';
                if (placeholder) soilSelect.appendChild(placeholder);
                list.forEach(item => {
                    const tok = (typeof item === 'string') ? item : (item.code || item.id || item.name_en || item.name);
                    const opt = document.createElement('option');
                    opt.value = tok;
                    // display a readable label if present
                    opt.textContent = (typeof item === 'string') ? tok : ((item.name_hi ? item.name_hi + ' | ' : '') + (item.name_en || item.name || tok));
                    soilSelect.appendChild(opt);
                });
                console.info('Loaded soil tokens from backend:', list);
            } catch (err) {
                console.warn('Failed to load soil types, keeping built-in list.', err);
            }
        }

        // Debug panel: fetch /api/debug/encoders and show it
        async function openDebugPanelWithEncoders() {
            try {
                const resp = await BackendAPI.getDebugEncoders();
                if (!resp.success) {
                    console.warn('debug encoders fetch failed:', resp.error || resp);
                    return;
                }
                const panel = document.getElementById('debugPanel');
                const pre = document.getElementById('debugPre');
                pre.textContent = JSON.stringify(resp.data, null, 2);
                panel.style.display = 'block';
                panel.setAttribute('aria-hidden', 'false');
                console.debug('Backend encoders:', resp.data);
            } catch (e) {
                console.error('Failed to fetch debug encoders:', e);
            }
        }

        // Auto-fill weather based on geolocation using backend proxy (optional)
        async function autoFillWeatherData() {
            try {
                const loc = await BackendAPI.getUserLocation();
                const weatherResp = await BackendAPI.getWeatherData(loc.latitude, loc.longitude);
                if (weatherResp.success && weatherResp.data) {
                    let temp = null, humidity = null;
                    const d = weatherResp.data;
                    if (d && d.hourly) {
                        temp = Array.isArray(d.hourly.temperature_2m) ? d.hourly.temperature_2m[0] : d.hourly.temperature_2m;
                        humidity = Array.isArray(d.hourly.relativehumidity_2m) ? d.hourly.relativehumidity_2m[0] : d.hourly.relativehumidity_2m;
                    }
                    if (temp !== null) document.getElementById('temp').value = Math.round(temp);
                    if (humidity !== null) document.getElementById('humidity').value = Math.round(humidity);
                    showNotification('Weather data updated from backend', 'success');
                } else {
                    showNotification('Unable to fetch weather from backend', 'warning');
                }
            } catch (err) {
                console.error('Auto-fill weather error:', err);
                showNotification('Location unavailable or weather fetch failed', 'warning');
            }
        }

        // Add weather button to UI
        function addWeatherButton() {
            const btn = document.createElement('button');
            btn.type = 'button';
            btn.className = 'weather-btn';
            btn.innerHTML = '<i class="fas fa-cloud-sun"></i> Auto-fill Weather';
            btn.style.cssText = 'background:linear-gradient(45deg,#3498db,#2980b9); color:white; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; margin-bottom:12px; width:100%; font-size:0.95rem;';
            btn.addEventListener('click', autoFillWeatherData);
            const firstRow = document.querySelector('.form-row');
            if (firstRow && firstRow.parentNode) firstRow.parentNode.insertBefore(btn, firstRow);
        }

        // Form submission - strict: send to backend, show error if backend fails/no data. No local simulation.
        document.getElementById('cropForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const soil = document.getElementById('soil').value;
            const sown = parseInt(document.getElementById('sown').value, 10);
            const soil_ph = parseFloat(document.getElementById('soil_ph').value);
            const temp = parseFloat(document.getElementById('temp').value);
            const humidity = parseFloat(document.getElementById('humidity').value);
            const nitrogen = parseFloat(document.getElementById('nitrogen').value);
            const phosphorus = parseFloat(document.getElementById('phosphorus').value);
            const potassium = parseFloat(document.getElementById('potassium').value);

            if (!soil || isNaN(sown) || isNaN(soil_ph) || isNaN(temp) || isNaN(humidity) || isNaN(nitrogen) || isNaN(phosphorus) || isNaN(potassium)) {
                showNotification('‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç / Please fill all required fields', 'warning');
                return;
            }

            const payload = {
                SOIL: String(soil),
                SOWN: Number(sown),
                SOIL_PH: Number(soil_ph),
                TEMP: Number(temp),
                RELATIVE_HUMIDITY: Number(humidity),
                N: Number(nitrogen),
                P: Number(phosphorus),
                K: Number(potassium)
            };

            try {
                setLoading(true);
                const resp = await BackendAPI.predictCrop(payload);

                if (!resp.success) {
                    const errMsg = resp.error || `Backend error (${resp.status || 'unknown'})`;
                    setLoading(false);
                    showErrorMessage(errMsg, resp);
                    return;
                }

                const data = resp.data;
                if (!data || (typeof data !== 'object')) {
                    setLoading(false);
                    showErrorMessage('Backend returned empty or invalid prediction.', null);
                    return;
                }

                const prediction = {
                    crop: (data.crop && (data.crop.label || data.crop)) || 'Unknown',
                    water_source: (data.water_source && (data.water_source.label || data.water_source)) || 'Unknown',
                    crop_duration: (data.crop_duration !== undefined ? `${Math.round(data.crop_duration)} ‡§¶‡§ø‡§® | ${Math.round(data.crop_duration)} days` : 'N/A'),
                    water_required: (data.water_required !== undefined ? `üíß ${Math.round(data.water_required)} L/kg` : 'N/A'),
                    confidence: (data.crop && data.crop.confidence !== undefined) ? data.crop.confidence : (data.confidence !== undefined ? data.confidence : null)
                };

                setLoading(false);
                displayResults(prediction);
            } catch (err) {
                console.error('Prediction flow error:', err);
                setLoading(false);
                showErrorMessage('Network or unexpected error while contacting backend.', null);
            }
        });

        // small focus animations
        document.querySelectorAll('.form-control').forEach(el => {
            el.addEventListener('focus', () => el.style.transform = 'scale(1.02)');
            el.addEventListener('blur', () => el.style.transform = 'scale(1)');
        });

        // Initialize
        async function initializeApp() {
            updateLanguage();
            addWeatherButton();

            try {
                const health = await BackendAPI.checkHealth();
                if (health.success) {
                    showNotification('‚úÖ Connected to Crop Sage AI Backend!', 'success');
                    // populate exact soil tokens from server
                    await populateSoilFromServer();
                } else {
                    showNotification('‚ö†Ô∏è Backend unreachable ‚Äî predictions will fail until backend is available', 'warning');
                }
            } catch (err) {
                console.error('Init error:', err);
                showNotification('üîÑ Backend unreachable', 'warning');
            }
        }

        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
